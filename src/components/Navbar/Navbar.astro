---
const wordmarkSrc = "/images/kaily-wordmark.svg";
const lottieSrc = "/lottie/logo.json";

const SUPPORT = {
  supportIcon: "/images/contactcall.svg",
  whatsappIcon: "/icons/whatsappicon.svg",
  qrImage: "/images/qr.svg",
  whatsappGreenIcon: "/images/whatsapp-colored.svg",
  mailIcon: "/images/email.svg",
  whatsappLink: "https://wa.me/YOUR_NUMBER",
  email: "support@kaily.ai",
};

const PRODUCT_LEFT = [
  {
    imgSrc: "/icons/Agenticon.svg",
    title: "AI Agent Studio",
    desc: "Design, build, and deploy engaging chatbots across various channels.",
  },
  {
    imgSrc: "/icons/actionicon.svg",
    title: "AI Actions",
    desc: "Stop waiting for developers. Automate your team’s work in minutes.",
  },
  { imgSrc: "/icons/mcpicon.svg", title: "MCP", desc: "" },
  { imgSrc: "/icons/workflowicon.svg", title: "AI Workflows", desc: "" },
  {
    imgSrc: "/icons/helpicon.svg",
    title: "AI Helpdesk",
    desc: "Manage support, streamline workflows, and improve efficiency.",
  },
];

const PRODUCT_RIGHT = [
  {
    imgSrc: "/icons/websiteicon.svg",
    title: "Website Chatbot",
    desc: "Engage visitors with smart AI chat",
  },
  {
    imgSrc: "/icons/callicon.svg",
    title: "AI Voice Calls",
    desc: "Offer natural voice conversations",
  },
  {
    imgSrc: "/icons/whatsappicon.svg",
    title: "WhatsApp",
    desc: "Chat with customers instantly",
  },
  {
    imgSrc: "/icons/iosicon.svg",
    title: "iOS",
    desc: "Add Kaily to your mobile app",
  },
  {
    imgSrc: "/icons/androidicon.svg",
    title: "Android",
    desc: "Embed AI into your mobile app",
  },
  {
    imgSrc: "/icons/mailicon.svg",
    title: "Email",
    desc: "Automate personalized email workflows",
  },
  {
    imgSrc: "/icons/slackicon.svg",
    title: "Slack",
    desc: "Collaborate better and automate updates on Slack",
  },
];

const SOLUTIONS = [
  {
    imgSrc: "/icons/shopicon.svg",
    title: "E-Commerce & Retail",
    desc: "Streamline Operations, Grow Revenue",
  },
  {
    imgSrc: "/icons/educationicon.svg",
    title: "Education",
    desc: "Empower learning, empower students",
  },
  {
    imgSrc: "/icons/travelicon.svg",
    title: "Travel & Hospitality",
    desc: "Help users with travel and boarding",
  },
  {
    imgSrc: "/icons/homeicon.svg",
    title: "BFSI",
    desc: "Banking, financial services, and insurance solutions.",
  },
  {
    imgSrc: "/icons/realestateicon.svg",
    title: "Real Estate",
    desc: "Engage homebuyers and close deals",
  },
];

const RESOURCES = [
  {
    imgSrc: "/icons/about.svg",
    title: "About Us",
    desc: "Meet the team reimagining how AI gets things done",
  },
  {
    imgSrc: "/icons/blog.svg",
    title: "Blog",
    desc: "Our team blog covering all things AI",
  },
  {
    imgSrc: "/icons/insight.svg",
    title: "Insights",
    desc: "Latest insights and deep dives into AI tools",
  },
  {
    imgSrc: "/icons/usecase.svg",
    title: "Usecases",
    desc: "Explore top usecases for Kaily AI",
  },
  {
    imgSrc: "/icons/affiliate.svg",
    title: "Affiliates",
    desc: "Register and start earning today.",
  },
  {
    imgSrc: "/icons/docs.svg",
    title: "Docs",
    desc: "Understand the Platform in detail.",
  },
];
---

<header
  class="fixed top-4 left-0 right-0 z-40 flex w-full justify-center"
  data-navbar
  aria-label="Main navigation"
>
  <nav
    class="flex w-full max-w-7xl items-center justify-between border-b border-gray-100 bg-white px-4 md:px-6 lg:rounded-full lg:border lg:shadow-sm"
  >
    <!-- Logo -->
    <a href="/" class="group inline-flex items-center gap-0 py-4">
      <div class="h-auto w-auto overflow-hidden rounded-md">
        <div
          class="h-auto w-12"
          data-logo-lottie
          data-src={lottieSrc}
          aria-hidden="true"
        >
        </div>
      </div>

      <img
        src={wordmarkSrc}
        alt="Kaily"
        class="h-5 w-auto"
        loading="eager"
        decoding="async"
      />
    </a>

    <!-- Desktop Nav -->
    <ul
      class="hidden items-center gap-1 text-sm font-medium text-gray-700 lg:flex"
    >
      <!-- Product -->
      <li class="relative" data-menu-root="product">
        <button
          type="button"
          class="flex cursor-pointer items-center gap-1 px-4 py-6 transition hover:text-gray-600 focus:outline-none"
          aria-haspopup="menu"
          aria-expanded="false"
          data-menu-trigger
        >
          <span>Product</span>
          <span
            class="chev inline-flex items-center justify-center transition-transform"
            aria-hidden="true">▾</span
          >
        </button>

        <div
          class="absolute left-1/2 top-full z-40 mt-4 hidden w-225 -translate-x-1/2 rounded-3xl bg-white p-6 shadow-2xl ring-1 ring-black/5"
          role="menu"
          data-menu-panel
        >
          <div class="grid grid-cols-2 gap-10">
            <div>
              <h3 class="mb-3.5 text-lg font-semibold text-gray-900">
                Platform Essentials
              </h3>

              <ul class="flex flex-col gap-4">
                {
                  PRODUCT_LEFT.slice(0, 2).map((x) => (
                    <li data-anim-item>
                      <a
                        href="#"
                        class="flex cursor-pointer items-start gap-4 rounded-lg px-2 py-2 transition hover:bg-[#cc99ff26]"
                      >
                        <img
                          src={x.imgSrc}
                          alt={x.title}
                          class="h-6 w-6 shrink-0 object-contain"
                        />
                        <div class="min-w-0">
                          <div class="text-base font-semibold text-gray-900">
                            {x.title}
                          </div>
                          {x.desc ? (
                            <div class="mt-1 text-sm font-medium text-gray-500">
                              {x.desc}
                            </div>
                          ) : null}
                        </div>
                      </a>
                    </li>
                  ))
                }

                {
                  PRODUCT_LEFT.slice(2, 4).map((x) => (
                    <li data-anim-item class="pl-12">
                      <a
                        href="#"
                        class="flex cursor-pointer items-start gap-4 rounded-lg px-2 py-2 transition hover:bg-[#cc99ff26]"
                      >
                        <img
                          src={x.imgSrc}
                          alt={x.title}
                          class="h-6 w-6 shrink-0 object-contain"
                        />
                        <div class="min-w-0">
                          <div class="text-base font-semibold text-gray-900">
                            {x.title}
                          </div>
                          {x.desc ? (
                            <div class="mt-1 text-sm font-medium text-gray-500">
                              {x.desc}
                            </div>
                          ) : null}
                        </div>
                      </a>
                    </li>
                  ))
                }

                <li data-anim-item>
                  <a
                    href="#"
                    class="flex cursor-pointer items-start gap-4 rounded-lg px-2 py-2 transition hover:bg-[#cc99ff26]"
                  >
                    <img
                      src={PRODUCT_LEFT[4].imgSrc}
                      alt={PRODUCT_LEFT[4].title}
                      class="h-6 w-6 shrink-0 object-contain"
                    />
                    <div class="min-w-0">
                      <div class="text-base font-semibold text-gray-900">
                        {PRODUCT_LEFT[4].title}
                      </div>
                      {
                        PRODUCT_LEFT[4].desc ? (
                          <div class="mt-1 text-sm font-medium text-gray-500">
                            {PRODUCT_LEFT[4].desc}
                          </div>
                        ) : null
                      }
                    </div>
                  </a>
                </li>
              </ul>
            </div>

            <div class="relative">
              <div class="absolute left-0 top-0 h-full w-px bg-gray-200/70">
              </div>

              <div class="pl-10">
                <h3 class="mb-3.5 text-lg font-semibold text-gray-900">
                  Conversational Channels
                </h3>

                <ul class="flex flex-col gap-4">
                  {
                    PRODUCT_RIGHT.map((x) => (
                      <li data-anim-item>
                        <a
                          href="#"
                          class="flex cursor-pointer items-start gap-4 rounded-lg px-2 py-2 transition hover:bg-[#cc99ff26]"
                        >
                          <img
                            src={x.imgSrc}
                            alt={x.title}
                            class="h-6 w-6 shrink-0 object-contain"
                          />
                          <div class="min-w-0">
                            <div class="text-base font-semibold text-gray-900">
                              {x.title}
                            </div>
                            {x.desc ? (
                              <div class="mt-1 text-sm font-medium text-gray-500">
                                {x.desc}
                              </div>
                            ) : null}
                          </div>
                        </a>
                      </li>
                    ))
                  }
                </ul>
              </div>
            </div>
          </div>
        </div>
      </li>

      <!-- Solutions -->
      <li class="relative" data-menu-root="solutions">
        <button
          type="button"
          class="flex cursor-pointer items-center gap-1 px-4 py-6 transition hover:text-gray-600 focus:outline-none"
          aria-haspopup="menu"
          aria-expanded="false"
          data-menu-trigger
        >
          <span>Solutions</span>
          <span
            class="chev inline-flex items-center justify-center transition-transform"
            aria-hidden="true">▾</span
          >
        </button>

        <div
          class="absolute left-1/2 top-full z-40 mt-4 hidden w-[380px] -translate-x-1/2 rounded-3xl bg-white p-6 shadow-2xl ring-1 ring-black/5"
          role="menu"
          data-menu-panel
        >
          <h3 class="mb-3.5 text-lg font-semibold text-gray-900">Industries</h3>

          <ul class="flex flex-col gap-4">
            {
              SOLUTIONS.map((x) => (
                <li data-anim-item>
                  <a
                    href="#"
                    class="flex w-full cursor-pointer items-start gap-4 rounded-lg px-2 py-2 transition hover:bg-[#cc99ff26]"
                  >
                    <img
                      src={x.imgSrc}
                      alt={x.title}
                      class="h-6 w-6 shrink-0 object-contain"
                    />
                    <div>
                      <div class="text-base font-semibold text-gray-900">
                        {x.title}
                      </div>
                      <div class="mt-1 text-sm font-medium text-gray-500">
                        {x.desc}
                      </div>
                    </div>
                  </a>
                </li>
              ))
            }
          </ul>
        </div>
      </li>

      <li class="px-4 py-6">
        <a href="/tools" class="cursor-pointer transition hover:text-gray-600"
          >Tools</a
        >
      </li>
      <li class="px-4 py-6">
        <a href="/pricing" class="cursor-pointer transition hover:text-gray-600"
          >Pricing</a
        >
      </li>

      <!-- Resources -->
      <li class="relative" data-menu-root="resources">
        <button
          type="button"
          class="flex cursor-pointer items-center gap-1 px-4 py-6 transition hover:text-gray-600 focus:outline-none"
          aria-haspopup="menu"
          aria-expanded="false"
          data-menu-trigger
        >
          <span>Resources</span>
          <span
            class="chev inline-flex items-center justify-center transition-transform"
            aria-hidden="true">▾</span
          >
        </button>

        <div
          class="absolute left-1/2 top-full z-40 mt-4 hidden w-[380px] -translate-x-1/2 rounded-3xl bg-white p-6 shadow-2xl ring-1 ring-black/5"
          role="menu"
          data-menu-panel
        >
          <ul class="flex flex-col gap-4">
            {
              RESOURCES.map((x) => (
                <li data-anim-item>
                  <a
                    href="#"
                    class="flex w-full cursor-pointer items-start gap-4 rounded-lg px-2 py-2 transition hover:bg-[#cc99ff26]"
                  >
                    <img
                      src={x.imgSrc}
                      alt={x.title}
                      class="h-6 w-6 shrink-0 object-contain"
                    />
                    <div>
                      <div class="text-base font-semibold text-gray-900">
                        {x.title}
                      </div>
                      {x.desc ? (
                        <div class="mt-1 text-sm font-medium text-gray-500">
                          {x.desc}
                        </div>
                      ) : null}
                    </div>
                  </a>
                </li>
              ))
            }
          </ul>
        </div>
      </li>
    </ul>

    <!-- Desktop actions -->
    <div class="hidden items-center gap-3 lg:flex">
      <!-- Support (desktop click) -->
      <div class="relative px-4 py-6" data-menu-root="support">
        <button
          type="button"
          class="flex items-center gap-2 rounded-full"
          aria-haspopup="menu"
          aria-expanded="false"
          data-menu-trigger
        >
          <img
            src={SUPPORT.supportIcon}
            alt=""
            aria-hidden="true"
            class="h-7 w-7"
          />
          <span
            class="chev inline-flex items-center justify-center
         bg-[linear-gradient(90deg,#9276FF_0.02%,#652FFF_99.98%)]
         bg-clip-text text-transparent transition-transform"
            aria-hidden="true"
          >
            ▾
          </span>
        </button>

        <div
          class="absolute right-0 top-full z-50 mt-3 hidden w-90 rounded-3xl bg-white p-5 shadow-2xl ring-1 ring-black/5"
          role="menu"
          data-menu-panel
        >
          <div class="space-y-4">
            <div>
              <div
                class="flex w-full cursor-pointer items-start gap-4 rounded-lg px-2 py-2 transition hover:bg-[#cc99ff26]"
              >
                <img
                  src={SUPPORT.whatsappIcon}
                  alt=""
                  aria-hidden="true"
                  class="h-6 w-6"
                />
                <div>
                  <div class="text-base font-semibold text-gray-900">
                    Chat on WhatsApp
                  </div>
                  <div class="mt-1 text-sm font-medium text-gray-500">
                    Message us for quick assistance
                  </div>
                </div>
              </div>

              <div
                class="mt-4 rounded-2xl border border-gray-200 p-4 text-center"
              >
                <img
                  src={SUPPORT.qrImage}
                  alt="WhatsApp QR"
                  class="mx-auto h-40 w-40 object-contain"
                  loading="lazy"
                  decoding="async"
                />

                <div class="mt-3 text-sm font-medium text-gray-500">
                  Scan the QR code to chat
                </div>
                <div class="my-2 text-sm font-semibold text-gray-400">OR</div>

                <a
                  href={SUPPORT.whatsappLink}
                  target="_blank"
                  rel="noreferrer"
                  class="inline-flex w-full items-center justify-center gap-2 rounded-full border border-gray-200 px-4 py-3 text-sm font-semibold text-gray-900 transition hover:bg-gray-50"
                >
                  <img
                    src={SUPPORT.whatsappGreenIcon}
                    alt=""
                    aria-hidden="true"
                    class="h-5 w-5"
                  />
                  Open WhatsApp
                </a>
              </div>
            </div>

            <a
              href={`mailto:${SUPPORT.email}`}
              class="flex w-full cursor-pointer items-start gap-4 rounded-lg px-2 py-2 transition hover:bg-[#cc99ff26]"
            >
              <img
                src={SUPPORT.mailIcon}
                alt=""
                aria-hidden="true"
                class="h-6 w-6"
              />
              <div>
                <div class="text-lg font-semibold text-gray-900">
                  {SUPPORT.email}
                </div>
                <div class="text-sm font-medium text-gray-500">
                  Send an email
                </div>
              </div>
            </a>
          </div>
        </div>
      </div>

      <a
        href="/login"
        class="rounded-full border border-[#9276ff] px-4 py-3 text-sm font-medium
               bg-[linear-gradient(90deg,#9276FF_0.02%,#652FFF_99.98%)] bg-clip-text text-transparent
               transition hover:bg-purple-50"
      >
        Sign In
      </a>

      <a
        href="/talk-to-sales"
        class="inline-flex items-center gap-2 rounded-full bg-[#cc99ff26] px-4 py-3 text-sm font-medium"
      >
        <img
          src="/images/calender.svg"
          alt=""
          aria-hidden="true"
          class="h-5 w-5"
        />
        <span
          class="bg-[linear-gradient(90deg,#9276FF_0.02%,#652FFF_99.98%)] bg-clip-text text-transparent"
        >
          Talk to Sales
        </span>
      </a>
    </div>

    <!-- ✅ Mobile / Tablet Right Icons (FIXED hit areas) -->
    <div class="flex items-center gap-3 lg:hidden">
      <button
        type="button"
        class="h-10 w-10 shrink-0 rounded-full transition hover:bg-gray-50 flex items-center justify-center"
        aria-label="Support"
        data-support-mobile-trigger
      >
        <img
          src={SUPPORT.supportIcon}
          alt=""
          aria-hidden="true"
          class="h-7 w-7"
        />
      </button>

      <button
        id="hamburger"
        aria-expanded="false"
        type="button"
        class="group relative h-10 w-10 shrink-0 rounded-full transition hover:bg-gray-50 flex items-center justify-center"
        style="--width:1.25rem;--thickness:0.125rem;--gap:0.25rem;--color:#000;--duration:300ms"
        aria-label="Toggle menu"
      >
        <!-- pointer-events-none prevents accidental targeting of inner spans -->
        <span
          class="pointer-events-none absolute left-1/2 top-1/2 h-[var(--thickness)] w-[var(--width)] -translate-x-1/2 translate-y-[calc(-150%-var(--gap))] transition-transform duration-[calc(var(--duration)*2/3)]
          before:absolute before:right-0 before:h-full before:w-full before:rounded-full before:bg-[var(--color)] before:transition-[width] before:delay-[calc(var(--duration)*1/3)] before:duration-[calc(var(--duration)*2/3)]
          group-aria-expanded:-translate-y-1/2 group-aria-expanded:-rotate-45 group-aria-expanded:delay-[calc(var(--duration)*1/3)]
          before:group-aria-expanded:w-[60%] before:group-aria-expanded:delay-0"
        ></span>

        <span
          class="pointer-events-none absolute left-1/2 top-1/2 h-[var(--thickness)] w-[var(--width)] -translate-x-1/2 -translate-y-1/2 rounded-full bg-[var(--color)]
          transition-transform duration-[calc(var(--duration)*2/3)]
          group-aria-expanded:rotate-45 group-aria-expanded:delay-[calc(var(--duration)*1/3)]"
        ></span>

        <span
          class="pointer-events-none absolute left-1/2 top-1/2 h-[var(--thickness)] w-[var(--width)] -translate-x-1/2 translate-y-[calc(50%+var(--gap))] transition-transform duration-[calc(var(--duration)*2/3)]
          before:absolute before:right-0 before:h-full before:w-[60%] before:rounded-full before:bg-[var(--color)] before:transition-[right] before:delay-[calc(var(--duration)*1/3)] before:duration-[calc(var(--duration)*2/3)]
          group-aria-expanded:-translate-y-1/2 group-aria-expanded:-rotate-45 group-aria-expanded:delay-[calc(var(--duration)*1/3)]
          before:group-aria-expanded:right-[40%] before:group-aria-expanded:delay-0"
        ></span>
      </button>
    </div>
  </nav>

  <!-- Mobile overlay -->
  <div
    class="fixed left-1/2 z-50 hidden -translate-x-1/2 overflow-y-auto rounded-3xl border border-gray-100 bg-white shadow-2xl"
    style="top: calc(var(--navbar-height, 88px) + 32px); width: 98%; bottom: 12px;"
    data-mobile-overlay
  >
    <div class="p-3">
      <!-- ✅ Support section (hidden by default; shows only when Support icon clicked) -->
      <div
        class="mb-3 hidden w-full bg-white lg:rounded-3xl lg:border lg:border-gray-100 lg:shadow-sm"
        data-support-mobile-section
      >
        <a
          href={SUPPORT.whatsappLink}
          target="_blank"
          rel="noreferrer"
          class="flex items-center justify-between px-4 py-4"
        >
          <div class="flex items-start gap-3">
            <img
              src={SUPPORT.whatsappIcon}
              class="h-6 w-6"
              alt=""
              aria-hidden="true"
            />
            <div>
              <div class="text-base font-semibold text-gray-900">
                Chat on WhatsApp
              </div>
              <div class="text-sm font-medium text-gray-500">
                Message us for quick assistance
              </div>
            </div>
          </div>
          <span class="text-xl text-purple-600">→</span>
        </a>

        <div class="h-px bg-gray-100"></div>

        <a
          href={`mailto:${SUPPORT.email}`}
          class="flex items-center justify-between px-4 py-4"
        >
          <div class="flex items-start gap-3">
            <img
              src={SUPPORT.mailIcon}
              class="h-6 w-6"
              alt=""
              aria-hidden="true"
            />
            <div>
              <div class="text-base font-semibold text-gray-900">
                {SUPPORT.email}
              </div>
              <div class="text-sm font-medium text-gray-500">
                Write us an email
              </div>
            </div>
          </div>
          <span class="text-xl text-purple-600">→</span>
        </a>
      </div>

      <!-- ✅ Everything else in one wrapper (hamburger shows this) -->
      <div data-mobile-menu-rest>
        <!-- Product accordion -->
        <div data-acc-root>
          <button
            type="button"
            class="flex w-full items-center justify-between rounded-2xl px-4 py-4 text-sm font-medium text-gray-900 transition"
            data-acc-trigger
          >
            Product <span class="acc-chev transition-transform">▾</span>
          </button>
          <div class="mt-2" data-acc-panel>
            <div class="acc-inner">
              <div class="mb-4 px-4 text-sm font-semibold text-gray-900">
                Platform Essentials
              </div>
              <div class="flex flex-col gap-4 px-4 pb-4">
                {
                  [...PRODUCT_LEFT, ...PRODUCT_RIGHT].map((x) => (
                    <a
                      href="#"
                      class="flex items-start gap-4 rounded-xl px-2 py-2 transition hover:bg-[#cc99ff26]"
                    >
                      <img
                        src={x.imgSrc}
                        alt={x.title}
                        class="h-6 w-6 shrink-0 object-contain"
                      />
                      <div>
                        <div class="text-sm font-semibold text-gray-900">
                          {x.title}
                        </div>
                        {x.desc ? (
                          <div class="mt-1 text-sm font-medium text-gray-500">
                            {x.desc}
                          </div>
                        ) : null}
                      </div>
                    </a>
                  ))
                }
              </div>
            </div>
          </div>
        </div>

        <!-- Solutions accordion -->
        <div data-acc-root>
          <button
            type="button"
            class="flex w-full items-center justify-between rounded-2xl px-4 py-4 text-sm font-semibold text-gray-900 transition"
            data-acc-trigger
          >
            Solutions <span class="acc-chev transition-transform">▾</span>
          </button>
          <div class="mt-2" data-acc-panel>
            <div class="acc-inner">
              <div class="mb-4 px-4 text-sm font-semibold text-gray-900">
                Industries
              </div>
              <div class="flex flex-col gap-4 px-4 pb-4">
                {
                  SOLUTIONS.map((x) => (
                    <a
                      href="#"
                      class="flex items-start gap-4 rounded-xl px-2 py-2 transition hover:bg-[#cc99ff26]"
                    >
                      <img
                        src={x.imgSrc}
                        alt={x.title}
                        class="h-6 w-6 shrink-0 object-contain"
                      />
                      <div>
                        <div class="text-sm font-semibold text-gray-900">
                          {x.title}
                        </div>
                        <div class="mt-1 text-sm font-medium text-gray-500">
                          {x.desc}
                        </div>
                      </div>
                    </a>
                  ))
                }
              </div>
            </div>
          </div>
        </div>

        <a
          href="/tools"
          class="flex items-center justify-between rounded-2xl px-4 py-4 text-sm font-semibold text-gray-900 transition hover:bg-gray-50"
        >
          Tools
        </a>

        <a
          href="/pricing"
          class="flex items-center justify-between rounded-2xl px-4 py-4 text-sm font-semibold text-gray-900 transition hover:bg-gray-50"
        >
          Pricing
        </a>

        <!-- Resources accordion -->
        <div data-acc-root>
          <button
            type="button"
            class="flex w-full items-center justify-between rounded-2xl px-4 py-4 text-sm font-semibold text-gray-900 transition"
            data-acc-trigger
          >
            Resources <span class="acc-chev transition-transform">▾</span>
          </button>
          <div class="mt-2" data-acc-panel>
            <div class="acc-inner">
              <div class="flex flex-col gap-4 px-4 pb-4">
                {
                  RESOURCES.map((x) => (
                    <a
                      href="#"
                      class="flex items-start gap-4 rounded-xl px-2 py-2 transition hover:bg-[#cc99ff26]"
                    >
                      <img
                        src={x.imgSrc}
                        alt={x.title}
                        class="h-6 w-6 shrink-0 object-contain"
                      />
                      <div>
                        <div class="text-sm font-semibold text-gray-900">
                          {x.title}
                        </div>
                        {x.desc ? (
                          <div class="mt-1 text-sm font-medium text-gray-500">
                            {x.desc}
                          </div>
                        ) : null}
                      </div>
                    </a>
                  ))
                }
              </div>
            </div>
          </div>
        </div>

        <div class="space-y-4 px-4 pb-6 pt-4">
          <a
            href="/login"
            class="block w-full rounded-full border border-gray-200 px-6 py-4 text-center text-lg font-medium text-purple-600"
          >
            Sign In
          </a>

          <a
            href="/talk-to-sales"
            class="flex w-full items-center justify-center gap-3 rounded-full bg-[#cc99ff26] px-6 py-4 text-center text-lg font-semibold"
          >
            <img
              src="/images/calender.svg"
              alt=""
              aria-hidden="true"
              class="h-5 w-5"
            />
            <span
              class="bg-[linear-gradient(90deg,#9276FF_0.02%,#652FFF_99.98%)] bg-clip-text text-transparent"
            >
              Talk to Sales
            </span>
          </a>
        </div>
      </div>
    </div>
  </div>
</header>

<style>
  [data-menu-panel] {
    opacity: 0;
    transform: translateY(-10px) scale(0.98);
    pointer-events: none;
    transition:
      opacity 180ms ease,
      transform 220ms cubic-bezier(0.2, 0.8, 0.2, 1);
    will-change: opacity, transform;
  }
  [data-menu-root][data-open="true"] [data-menu-panel] {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: auto;
  }
  [data-menu-root][data-open="true"] .chev {
    transform: rotate(180deg);
  }

  [data-mobile-overlay] {
    opacity: 0;
    pointer-events: none;
    transition: opacity 180ms ease;
  }
  [data-mobile-overlay][data-open="true"] {
    opacity: 1;
    pointer-events: auto;
  }

  [data-acc-panel] {
    display: grid;
    grid-template-rows: 0fr;
    opacity: 0;
    transform: translateY(-6px);
    transition:
      grid-template-rows 220ms ease,
      opacity 160ms ease,
      transform 200ms ease;
  }
  [data-acc-panel] > .acc-inner {
    overflow: hidden;
  }
  [data-acc-root][data-open="true"] [data-acc-panel] {
    grid-template-rows: 1fr;
    opacity: 1;
    transform: translateY(0);
  }
  [data-acc-root][data-open="true"] .acc-chev {
    transform: rotate(180deg);
  }
</style>

<!-- Lottie hover play (logo) -->
<script is:inline type="module">
  import lottie from "https://esm.sh/lottie-web@5.12.2";

  const nav = document.querySelector("[data-navbar]");
  if (!nav) throw new Error("Navbar: [data-navbar] not found");

  const logoLink = nav.querySelector("a.group");
  const holder = nav.querySelector("[data-logo-lottie]");
  if (!logoLink || !holder) throw new Error("Navbar: logo elements missing");

  const src = holder.getAttribute("data-src");
  if (!src) throw new Error("Navbar: logo lottie src missing");

  const anim = lottie.loadAnimation({
    container: holder,
    renderer: "svg",
    loop: false,
    autoplay: false,
    path: src,
    rendererSettings: { preserveAspectRatio: "xMidYMid meet" },
  });

  const play = () => {
    try {
      anim.goToAndPlay(0, true);
    } catch {}
  };
  const stop = () => {
    try {
      anim.stop();
    } catch {}
  };

  logoLink.addEventListener("mouseenter", play);
  logoLink.addEventListener("mouseleave", stop);
  logoLink.addEventListener("focusin", play);
  logoLink.addEventListener("focusout", stop);

  document.addEventListener("visibilitychange", () => {
    if (document.hidden) stop();
  });
</script>

<!-- Dropdowns + Mobile overlay logic (FIXED) -->
<script is:inline type="module">
  const navbar = document.querySelector("[data-navbar]");
  if (!navbar) throw new Error("Navbar: [data-navbar] not found");

  const isDesktop = () => window.matchMedia("(min-width: 1024px)").matches;

  // Set navbar height CSS var (used by overlay top offset)
  const setHeightVar = () => {
    const h = navbar.getBoundingClientRect().height;
    document.documentElement.style.setProperty("--navbar-height", `${h}px`);
  };
  setHeightVar();
  window.addEventListener("resize", setHeightVar);

  /* ---------------- Mobile overlay refs ---------------- */
  const hamburger = document.getElementById("hamburger");
  const mobileOverlay = navbar.querySelector("[data-mobile-overlay]");
  const supportMobileBtn = navbar.querySelector(
    "[data-support-mobile-trigger]",
  );
  const supportSection = navbar.querySelector("[data-support-mobile-section]");
  const overlayContent = mobileOverlay?.querySelector(":scope > .p-3");

  const getNonSupportNodes = () => {
    if (!supportSection || !overlayContent) return [];
    const nodes = Array.from(overlayContent.children);
    const idx = nodes.indexOf(supportSection);
    if (idx === -1) return nodes;
    return nodes.filter((_, i) => i !== idx);
  };
  const nonSupportNodes = getNonSupportNodes();

  const lockBody = (lock) => {
    document.body.style.overflow = lock ? "hidden" : "";
  };

  const closeAllAccordions = () => {
    navbar.querySelectorAll("[data-acc-root]").forEach((r) => {
      r.setAttribute("data-open", "false");
    });
  };

  const isOverlayOpen = () =>
    mobileOverlay?.getAttribute("data-open") === "true";

  const setHamburgerExpanded = (expanded) => {
    if (!hamburger) return;
    hamburger.setAttribute("aria-expanded", expanded ? "true" : "false");
  };

  const hideMobileSupport = () => supportSection?.classList.add("hidden");
  const showMobileSupport = () => supportSection?.classList.remove("hidden");

  const showFullMobileMenu = () => {
    hideMobileSupport();
    nonSupportNodes.forEach((el) => el.classList.remove("hidden"));
  };

  const showSupportOnlyMobileMenu = () => {
    showMobileSupport();
    nonSupportNodes.forEach((el) => el.classList.add("hidden"));
  };

  const openOverlay = ({ animateHamburger }) => {
    if (!mobileOverlay) return;
    mobileOverlay.classList.remove("hidden");
    mobileOverlay.setAttribute("data-open", "true");
    lockBody(true);
    if (animateHamburger) setHamburgerExpanded(true);
  };

  const closeOverlay = ({ animateHamburger }) => {
    if (!mobileOverlay) return;

    mobileOverlay.setAttribute("data-open", "false");
    lockBody(false);
    closeAllAccordions();

    // reset to default
    showFullMobileMenu();

    if (animateHamburger) setHamburgerExpanded(false);

    window.setTimeout(() => {
      if (mobileOverlay.getAttribute("data-open") === "true") return;
      mobileOverlay.classList.add("hidden");
    }, 200);
  };

  /* ---------------- Desktop dropdowns ---------------- */
  const roots = Array.from(navbar.querySelectorAll("[data-menu-root]"));
  let openRoot = null;
  let closeTimer = null;

  const openMenu = (root) => {
    const panel = root.querySelector("[data-menu-panel]");
    const trigger = root.querySelector("[data-menu-trigger]");
    if (!panel || !trigger) return;

    if (isDesktop() && isOverlayOpen())
      closeOverlay({ animateHamburger: true });

    if (openRoot && openRoot !== root) closeMenu(openRoot);

    panel.classList.remove("hidden");
    root.setAttribute("data-open", "true");
    trigger.setAttribute("aria-expanded", "true");
    openRoot = root;
  };

  const closeMenu = (root) => {
    const panel = root.querySelector("[data-menu-panel]");
    const trigger = root.querySelector("[data-menu-trigger]");
    if (!panel || !trigger) return;

    root.setAttribute("data-open", "false");
    trigger.setAttribute("aria-expanded", "false");

    window.setTimeout(() => {
      if (root.getAttribute("data-open") === "true") return;
      panel.classList.add("hidden");
    }, 220);

    if (openRoot === root) openRoot = null;
  };

  const closeAllDesktopMenus = () => {
    roots.forEach((r) => closeMenu(r));
    openRoot = null;
  };

  const scheduleClose = (root) => {
    window.clearTimeout(closeTimer);
    closeTimer = window.setTimeout(() => closeMenu(root), 220);
  };

  const cancelClose = () => {
    window.clearTimeout(closeTimer);
    closeTimer = null;
  };

  roots.forEach((root) => {
    root.addEventListener("mouseenter", () => {
      if (!isDesktop()) return;
      cancelClose();
      openMenu(root);
    });

    root.addEventListener("mouseleave", () => {
      if (!isDesktop()) return;
      scheduleClose(root);
    });
  });

  document.addEventListener("mousedown", (e) => {
    if (!isDesktop()) return;
    if (!openRoot) return;
    if (openRoot.contains(e.target)) return;
    closeMenu(openRoot);
  });

  document.addEventListener("keydown", (e) => {
    if (e.key !== "Escape") return;
    if (openRoot) closeMenu(openRoot);
    if (isOverlayOpen()) closeOverlay({ animateHamburger: true });
  });

  /* ---------------- Auto-open SUPPORT after full load + 3s (desktop only, once/session) ---------------- */
  const supportRoot = navbar.querySelector('[data-menu-root="support"]');
  const AUTO_KEY = "kaily_support_autoshown";

  const autoOpenSupportOnce = () => {
    if (!isDesktop()) return;
    if (!supportRoot) return;
    if (sessionStorage.getItem(AUTO_KEY) === "1") return;
    if (openRoot) return;

    sessionStorage.setItem(AUTO_KEY, "1");
    openMenu(supportRoot);
  };

  const startAutoOpenTimer = () => window.setTimeout(autoOpenSupportOnce, 3000);

  if (document.readyState === "complete") startAutoOpenTimer();
  else window.addEventListener("load", startAutoOpenTimer, { once: true });

  /* ---------------- Mobile interactions ---------------- */

  const getMode = () => {
    const supportVisible =
      supportSection && !supportSection.classList.contains("hidden");
    const otherVisible = nonSupportNodes.some(
      (el) => !el.classList.contains("hidden"),
    );
    if (supportVisible && !otherVisible) return "support";
    if (!supportVisible && otherVisible) return "menu";
    return "unknown";
  };

  // ✅ Hamburger toggles the FULL menu
  hamburger?.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();

    closeAllDesktopMenus();

    const mode = getMode();

    // If overlay open in support mode -> switch to menu mode (and animate hamburger)
    if (isOverlayOpen() && mode === "support") {
      showFullMobileMenu();
      setHamburgerExpanded(true);
      return;
    }

    // normal toggle
    if (isOverlayOpen()) closeOverlay({ animateHamburger: true });
    else {
      showFullMobileMenu();
      openOverlay({ animateHamburger: true });
    }
  });

  // ✅ Support button opens/closes SUPPORT overlay ONLY (hamburger must NOT become cross)
  supportMobileBtn?.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();

    closeAllDesktopMenus();

    // CRITICAL: support must never show hamburger as open/cross
    setHamburgerExpanded(false);

    const mode = getMode();

    // If overlay open and currently support mode -> close overlay (without changing hamburger)
    if (isOverlayOpen() && mode === "support") {
      closeOverlay({ animateHamburger: false });
      setHamburgerExpanded(false);
      return;
    }

    // If overlay open and currently menu mode -> switch to support-only mode
    if (isOverlayOpen() && mode === "menu") {
      showSupportOnlyMobileMenu();
      setHamburgerExpanded(false);
      requestAnimationFrame(() => {
        supportSection?.scrollIntoView({ behavior: "smooth", block: "start" });
      });
      return;
    }

    // If overlay closed -> open in support-only mode (no hamburger animation)
    openOverlay({ animateHamburger: false });
    showSupportOnlyMobileMenu();
    setHamburgerExpanded(false);

    requestAnimationFrame(() => {
      supportSection?.scrollIntoView({ behavior: "smooth", block: "start" });
    });
  });

  window.addEventListener("resize", () => {
    if (isDesktop() && isOverlayOpen())
      closeOverlay({ animateHamburger: true });
  });

  /* ---------------- Mobile accordions ---------------- */
  navbar.querySelectorAll("[data-acc-root]").forEach((root) => {
    const trigger = root.querySelector("[data-acc-trigger]");
    if (!trigger) return;

    root.setAttribute("data-open", "false");

    trigger.addEventListener("click", (e) => {
      e.preventDefault();
      const open = root.getAttribute("data-open") === "true";
      root.setAttribute("data-open", open ? "false" : "true");
    });
  });

  mobileOverlay?.addEventListener("click", (e) => {
    const a = e.target.closest("a");
    if (!a) return;
    closeOverlay({ animateHamburger: true });
  });

  // Initial mobile state
  showFullMobileMenu();
  setHamburgerExpanded(false);
</script>
